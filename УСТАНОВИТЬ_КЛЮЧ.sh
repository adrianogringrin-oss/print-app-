#!/bin/bash
# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenAI API –∫–ª—é—á–∞

echo "üîê –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenAI API –∫–ª—é—á–∞"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–ª—é—á –ø–µ—Ä–µ–¥–∞–Ω
if [ -z "$1" ]; then
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./–£–°–¢–ê–ù–û–í–ò–¢–¨_–ö–õ–Æ–ß.sh –≤–∞—à-api-–∫–ª—é—á"
    echo ""
    echo "–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ:"
    read -sp "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à OpenAI API –∫–ª—é—á: " API_KEY
    echo ""
    
    if [ -z "$API_KEY" ]; then
        echo "‚ùå –ö–ª—é—á –Ω–µ –≤–≤–µ–¥–µ–Ω"
        exit 1
    fi
else
    API_KEY="$1"
fi

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ —Ñ–∞–π–ª
KEY_FILE="$HOME/.openai_api_key"

echo "$API_KEY" > "$KEY_FILE"
chmod 600 "$KEY_FILE"  # –¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º

echo "‚úÖ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: $KEY_FILE"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω
if [ -f "$KEY_FILE" ]; then
    SAVED_KEY=$(cat "$KEY_FILE")
    if [ "$SAVED_KEY" = "$API_KEY" ]; then
        echo "‚úì –ö–ª—é—á —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!"
        echo ""
        echo "–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å: ./–ó–ê–ü–£–°–¢–ò–¢–¨_–°_–ò–ò.command"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–∞"
        exit 1
    fi
else
    echo "‚ùå –§–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞–Ω"
    exit 1
fi
